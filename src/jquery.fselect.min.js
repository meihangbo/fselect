/*!
 @Name：  fselect v0.0.1 下拉列表组件
 @author     meihangbo
 @email      meihangbo@126.com
 @version   0.0.1
 @update   2015-08-20
 */
!function(t){"use strict";var e={_uuid:function(){for(var t=[],e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",a=0;36>a;a++)t[a]=e.substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]=e.substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("")},_stopevent:function(t){t=t||window.event,t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},_isie6:function(){return!!window.ActiveXObject&&!window.XMLHttpRequest},_log:function(t){window.console&&console.log(t)}},a={_options:{},_defaultText:"",_init:function(i){var s=t.extend({},t.fn.fselect.defaults,i);return a._defaultText=s.defaulttext,a._options=s,this.each(function(){var i=e._uuid(),l="fselect_"+i,n=s.data;if(t(this).attr("data-uuid",i),"select"===t(this)[0].tagName.toLocaleLowerCase()){var d=a._getoptionsdata(t(this));n=n&&n.length>0||d,t(this).attr("id")&&t(this).attr("id").length>0&&(l="fselect_"+t(this).attr("id")),t('<div id="'+l+'" class="fselectbox" data-uuid="'+i+'"></div>').insertAfter(t(this)),a._creatui(t("#"+l),s),s.data&&s.data.length>0&&(t(this).html(""),a._setoptionsdata(t(this),n)),a._setuidata(t("#"+l).find(".fselect_ul"),n),t(this).hide(),a._setstyle(t("#"+l),s),a._clickhandler(t("#"+l),s)}else{a._creatui(t(this),s),a._setuidata(t(this).find(".fselect_ul"),n);var c="select_"+i;a._creatselect(t(this),c),a._setoptionsdata(t("#"+c),n),t("#"+c).attr("data-uuid",i),a._setstyle(t(this),s),a._clickhandler(t(this),s)}})},_creatui:function(t,i){t.html('<dl class="fselect"><dt class="fselect_dt '+i.arrowclass+'" data-svalue="">'+a._defaultText+'</dt><dd class="fselect_dd"><div class="fselect_options"><ul class="fselect_ul"></ul></div></dd></dl>'),e._isie6()&&t.find(".fselect_dd").append('<iframe src="" frameborder="0" framespacing="0" hspace="0"   vspace="0" marginheight="0" marginwidth="0" scrolling="no" class="ie6iframe"></iframe>')},_creatselect:function(e,a){t('<select id="'+a+'"></select>').hide().insertBefore(e)},_getoptionsdata:function(t){for(var e=[],a=t.children("option"),i=a.length,s=0;i>s;s++){var l=a[s].value,n=a[s].text,d=a[s].getAttribute("selected")?!0:!1;l&&l.length>0&&e.push([l,n,d])}return e},_setoptionsdata:function(e,i){if(e){var s=t.isArray(i)?i:[],l=s.length,n="",d="";d='<option value="" selected="selected">'+a._defaultText+"</option>";for(var c=0;l>c;c++)t.isArray(s[c])&&s[c].length>1&&(d+='<option value="'+s[c][0]+'">'+s[c][1]+"</option>",s[c][2]&&"boolean"===t.type(s[c][2])&&(n=s[c][0]));e.html(d),e.val(n)}},_setuidata:function(e,i){if(e){var s=t.isArray(i)?i:[],l=s.length,n="",d=["",a._defaultText,!0],c="";n+='<li class="fselect_li" data-svalue = "" data-stext="'+a._defaultText+'" ><a href="javascript:;">'+a._defaultText+"</a></li>";for(var o=0;l>o;o++)t.isArray(s[o])&&s[o].length>1&&(s[o][2]&&"boolean"===t.type(s[o][2])?(d=s[o],c="on"):c="",n+='<li class="fselect_li '+c+'" data-svalue = "'+s[o][0]+'" data-stext="'+s[o][1]+'" ><a href="javascript:;">'+s[o][1]+"</a></li>");e.html(n),0===e.find("li.on").length&&e.find('.fselect_li[data-svalue=""]').addClass("on"),e.parents(".fselect").find(".fselect_dt").attr("data-svalue",d[0]).html(d[1]),a._setuiheight(e,a._options)}},_setstyle:function(t,a){var i=a.width,s=a.height<30?30:a.height,l=0;e._isie6()&&(l=2),t.css({width:i+"px",height:s+"px","line-height":s+"px"}).find(".fselect").css({width:i+"px"}).find(".fselect_dt").css({height:s+"px","line-height":s+"px"}),t.find(".fselect_dd").css({width:i+l+"px",top:s+"px"}).find(".fselect_options").css({width:i+"px"}).find(".fselect_li").css({height:s+"px","line-height":s+"px"}),e._isie6()&&t.find(".ie6iframe").css({width:a.width+2*l+"px",height:t.find(".fselect_dd").height()})},_setuiheight:function(t,e){e.height=e.height||30;var a=parseInt(e.height)<30?30:parseInt(e.height),i=e.colnumber||6,s=t.find(".fselect_li").length,l=1;l=s>i?i:s,t.height(a*l+"px")},_clickhandler:function(i,s){var l=parseInt(i.css("z-index"))||999;i.on("click",".fselect_dt",function(){var e=t(this).parent();e.find(".fselect_dd").is(":hidden")?a._showlist(t(this),l):a._hidealllist(l)}).on("click",".fselect_li",function(){var e=t(this).parents(".fselect");t(this).parent().find(".fselect_li").removeClass("on"),e.find(".fselect_dt").attr("data-svalue",t(this).attr("data-svalue")).html(t(this).text()),a._hidealllist(l),t(this).addClass("on");var i=e.parent().attr("data-uuid");t('select[data-uuid="'+i+'"]').val(t(this).attr("data-svalue")),t.isFunction(s.onselect)&&s.onselect([t(this).attr("data-svalue"),t(this).text()])});var n=t._data(t("body")[0],"events");n||t("body").on("click",function(i){e._stopevent(i),t(i.target).parents(".fselectbox").length<1?a._hidealllist(l):""})},_showlist:function(t,e){a._hidealllist(e),t.parent().parent().css("z-index",e+1).find(".fselect_dd").fadeIn("fast")},_hidelist:function(){},_hidealllist:function(e){t(".fselect_dd").slideUp(50,function(){t(this).parent().parent().css("z-index",e)})},_setval:function(e,a){var i=e.find('li[data-svalue="'+a+'"]'),s=i.attr("data-stext"),l=e.attr("data-uuid");a!==e.find(".fselect_li.on").attr("data-svalue")&&(e.find(".fselect_li").removeClass("on"),i.addClass("on"),e.find(".fselect_dt").text(s).attr("data-svalue",a),t('select[data-uuid="'+l+'"]').val(a))},_loaddata:function(e,i,s){var l=e.find(".fselect_ul"),n=e.attr("data-uuid"),d=t('select[data-uuid="'+n+'"]');a._setuidata(l,i),a._setoptionsdata(d,i),(s=s||t.noop)()},_additem:function(e,a,i){if(e){for(var s=t.isArray(a)?a:[],l=s.length,n="",d="",c=e.find(".fselect_ul"),o=e.attr("data-uuid"),f=t('select[data-uuid="'+o+'"]'),r=0;l>r;r++)t.isArray(s[r])&&s[r].length>1&&c.find('.fselect_li[data-svalue="'+s[r][0]+'"]').length<1&&(n+='<li class="fselect_li" data-svalue = "'+s[r][0]+'" data-stext="'+s[r][1]+'" ><a href="javascript:;">'+s[r][1]+"</a></li>",d+='<option value="'+s[r][0]+'">'+s[r][1]+"</option>");c.append(n),f.append(d),(i=i||t.noop)()}},_removeitem:function(e,i,s){if(e){for(var l=t.isArray(i)?i:[],n=l.length,d=e.find(".fselect_ul"),c=e.attr("data-uuid"),o=t('select[data-uuid="'+c+'"]'),f=0;n>f;f++){d.find('.fselect_li[data-svalue="'+l[f]+'"]').remove(),o.find('option[value="'+l[f]+'"]').remove();var r=e.find(".fselect_dt");l[f]===r.attr("data-svalue")&&r.attr("data-svalue","").html(a._defaultText)}(s=s||t.noop)()}},_disabled:function(e,a){e.off("click",".fselect_dt"),e.find(".fselect").addClass("desable"),(a=a||t.noop)()},_enable:function(e,i){e.find(".fselect").removeClass("desable");var s=parseInt(e.css("z-index"))||999;e.on("click",".fselect_dt",function(){var e=t(this).parent();e.find(".fselect_dd").is(":hidden")?a._showlist(t(this),s):a._hidealllist(s)}),(i=i||t.noop)()}},i={val:function(e){var i=this[0],s=t(i).find(".fselect_dt");return e?void a._setval(t(i),e):[s.attr("data-svalue"),s.text()]},loaddata:function(e,i){e&&t.isArray(e)&&e.length>0&&a._loaddata(this,e,i)},additem:function(t,e){a._additem(this,t,e)},removeitem:function(t,e){a._removeitem(this,t,e)},disabled:function(t){a._disabled(this,t)},enable:function(t){a._enable(this,t)}};t.fn.fselect=function(e){var e=arguments[0];return i[e]?i[e].apply(this,Array.prototype.slice.call(arguments,1)):e&&"object"!=typeof e?void t.error("&#x65b9;&#x6cd5; "+e+"&#x4e0d;&#x5b58;&#x5728;!"):a._init.apply(this,arguments)},t.fn.fselect.defaults={width:200,height:30,arrowclass:"fselect_arrow",colnumber:6,defaulttext:"&#x8bf7;&#x9009;&#x62e9;",data:[],onselect:null}}(jQuery);